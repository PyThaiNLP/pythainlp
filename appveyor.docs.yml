image: ubuntu1604

skip_commits:
  message: /\(skip ci docs\)/     # Skip a new build if message contains '(skip ci docs)'

install:
  - sudo apt-get update && sudo apt-get install -y pandoc python3
  - sudo apt-get install -y python3-sphinx
  - sudo pip install -r requirements.txt


# configuration for deploy mode, commit message with /(build and deloy docs)/
# 1. build documents and upload HTML files to Appveyor's storage
# 2. upload to thainlp.org/pythainlp/docs/<brnach_bane>

only_commits:
  message: /(build and deloy docs)/    

build_script: 
  - cd docs
  - sudo make html
  - echo "Done building HTML files for the branch -- ${APPVEYOR_REPO_BRANCH}"
  - echo "Start cleaning the directory /tutorials"
  - sudo bash ./clean_directory.sh $FTP_USER $FTP_PASSWORD $FTP_HOST $APPVEYOR_REPO_BRANCH
  - echo "Uploading files to `thainlp.org/pythainlp/docs<version>`"
  - cd ./build/html
  - find . -type f -name "*" -print -exec curl --ftp-create-dir --ipv4 -T {} ftp://${FTP_USER}:${FTP_PASSWORD}@${FTP_HOST}/public_html/pythainlp/docs/${APPVEYOR_REPO_BRANCH}/{} \;
  - echo "Done uploading"
  - echo "Done uploading files to -- thainlp.orgpythainlp/docs/${APPVEYOR_REPO_BRANCH}"

artifacts:
  - path: ./build/html
    name: document